import argparse
import os
import requests
from tqdm import tqdm
import hashlib

def download_file(url, filename):
    try:
        response = requests.get(url, stream=True)
        total_size = int(response.headers.get("content-length", 0))
        block_size = 1024
        progress_bar = tqdm(total=total_size, unit="iB", unit_scale=True)
        hasher = hashlib.sha256()

        with open(filename, "wb") as file:
            for data in response.iter_content(block_size):
                progress_bar.update(len(data))
                file.write(data)
                hasher.update(data)

        progress_bar.close()

        if total_size != 0 and progress_bar.n != total_size:
            print("Error downloading the file. Please try again.")
            os.remove(filename)
        else:
            print(f"File downloaded successfully: {filename}")
            hash_result = hasher.hexdigest()
            print(f"SHA256 Hash: {hash_result}")

    except requests.exceptions.RequestException as e:
        print(f"Error downloading the file: {e}")

def open_folder(path):
    try:
        if os.name == "nt":
            os.system(f"explorer {os.path.abspath(path)}")
        else:
            os.system(f"xdg-open {os.path.abspath(path)}")
    except Exception as e:
        print(f"Failed to open the folder: {e}")

def main():
    # Parse the command-line arguments
    parser = argparse.ArgumentParser(description="Download file from URL")
    parser.add_argument("url", help="URL of the file to download")
    args = parser.parse_args()

    url = args.url
    filename = os.path.basename(url)

    download_file(url, filename)

    choice = input("Do you want to open the folder where the downloaded file is saved? (Y/N): ")
    if choice.lower() == "y":
        folder_path = os.path.dirname(os.path.abspath(filename))
        open_folder(folder_path)

if __name__ == "__main__":
    main()
